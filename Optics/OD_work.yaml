######################################################
# 2021 OD YAML card to simulate photons in nEXO's outer detector
# Contact: Emma Klemets (emma.klemets@mail.mcgill.ca)
######################################################
Version: 2019 nEXO Baseline
ChromaPath: '/home/eklem/chromasim/chroma-simulation'
ChromaImage: '[ChromaPath]/../chroma_latest.sif'

Detector:                                   # Define parameters for the construction of the detector geometry
  DetectorName: nEXO_OD                        # Defines detector name 
  PathToDetector: '[ChromaPath]/Geometry/OD/'  # Location of STL files 
  OpticalProperties: '[ChromaPath]/Yaml/OpticalProperties_OD.yaml' # Location of YAML card that contains optical properties
  CacheName: nEXO_OD # Location where geometry will be cached for rerunning same simulation
  ReflectivityData: '[ChromaPath]/Data/' # Location of reflectivity data for PMTs ???
  Save: True                                # Boolean that decides if geometry will be saved 
  BuildDetector: FromSTL                  # [FromSTL, FromMesh, FromCache] Geometry can either be rebuild from scratch using STL or a prebuild geomtry can be loaded via Pickle
  Center: WaterTank                     # Defines which component will be used to define the coordinate system
  Detector: PMTs                            # Defines which component has detecting surface and will be used to define readout channels
  DetectorOrientation: CylinderBarrel       # [CylinderBarrel, CylinderCap] Orientation of photodetectors, only important if surface of detector component is divided based on orientation
  FiducialVolume:                           # Choose components that will be used to define the fidicual volume
    Top: TopSupports                              # Component that defines max z position 
    Bottom: WaterTank                         # Component that defines min z position 
    Radius: WaterTank            # Component that defines max r position 
  FiducialHeightCut: 15                     # Defines standoff in the z direction wrt Top and Bottom in FiducialVolume
  FiducialRadialCut: 15                     # Define standoff in the radial direction wrt Radius in FiducialVolume
  SkinVolume:                               # Choose components that will be used to define the skin volume, max and min z will be same as for FiducialVolume
    InnerRadius: not sure        # Component that defines min r position 
    OuterRadius: WaterTank                       # Component that defines max r position 
    Top: TopSupports                      # Component that defines max z position 
    Bottom: WaterTank                   # Component that defines min z position 
  SkinStandoffTop: 0.5                      # Defines standoff in the z direction wrt Top and Bottom in FiducialVolume
  SkinStandoffBottom: 0.5                   # Define standoff in the radial direction wrt Radius in FiducialVolume
  Rotation: None
  # ChannelID: '[ChromaPath]/Data/nEXO_SiPM_ChannelID_2019.csv' #I guess we'll need PMT IDs

Simulation:                                 # Define parameters for the simulation of events inside the specifed volume
  Generator: Beam,-Z                        # Where and how the photons are generated
  NumberOfPhotons: 10                      # number of photons per event 
  NumberOfSources: 1                        # number of events 
  NumberOfRuns: 1                           # number of runs define how often NumberOfPhotons x NumberOfSources will be simulated
  PropagationMode: Total                    # [Total, Step] define if only photon origin and last photon location should be saved or if step-by-step information is required
  PhotonLocation: UniformFV              # [Center, UniformFV, UniformSkin, UniformXenon, R=, Z=] Define where events should be generated 
  OutputPath: '[ChromaPath]/../data/OD/2021/' # Location where simulation data is saved
  OutputFilename: test                 # Additional string variable to name current study
  OutputFiletype: HDF5                      # Define output format, currently only HDF5
  SaveVariables: ['DetectionFlag', 'NumDetected', 'IncidentAngles', 'Flags', 'LastHitTriangle', 'FinalPosition']

# This part is optional and can be used to directly modify the entries in the YAML card with the optical properties
# A wrapper script can generate different YAML cards that vary different parameters under ChangeOpticalParameters
# It is important to use the same notation for the materials and parameters as in OpticalProperties
# If commented out, the standard values from OpticalProperties will be used 
# ChangeOpticalParameters: 
#   Multisim: True
#   Components:
#       LXenon:
#         ScatteringLength: [300,3000,10]
#     FieldShapingRings:                    
#       SpecularReflectivity: [0.0,1.0,11]   
#       Combine: Cathode 
#       Constrain:
#         Parameter: Absorption
#         Value: 1.0  
    # Anode:                     
    #   SpecularReflectivity: [0.0,1.0,5]    
    #   Constrain:
    #     Parameter: Absorption
    #     Value: 1.0     
  # FieldShapingRings:
  #   Absorption: 0.0
  #   SpecularReflectivity: 1.0
  # Cathode:
  #   Absorption: 0.0
  #   SpecularReflectivity: 1.0

# Definitiona of surface properties based on values defined in OpticalProperties
# Each component need to be assigned an inner and outer material. 
# The inner material 'Inside' always has only one component
# The outer material 'Outside', 'Surface' and 'Color' can have multiple entries depending on the geometry (i.e. Quartz facing LXe on one side and Silicon on the other)
# If either one of 'Outside', 'Surface' and 'Color' have 3 entries all have to have 3 entries
# The orientation of the 3 properties is given according to DetectorOrientation
# For CylinderBarrel, 1st entry is facing radially inward, the 2nd radially outward and the 3rd perpendicular to the radial direction
# Colors are defined in Detector.py
Components: 
  PMT:
    Inside: [FullAbsorb]
    Outside: [Water]
    Surface: [BGlass] 
    Color: [Red]
    # Rotation: [Z,24]              # defines repeated addition of the same mesh with [axis of rotation, number of copies]
  # PMTSupports:
  #   Inside: [FullAbsorb]
  #   Outside: [Water]
  #   Surface: [StainlessSteel] 
  #   Color: [Grey]
  #   # Rotation: [Z,24] 
  WaterTank:
    Inside: [Water]
    Outside: [Vaccum]
    Surface: [ReflectiveFoil]
    Color: [Blue]
  OuterCyrostat:
    Inside: [FullAbsorb]
    Outside: [Water]
    Surface: [OC_surface] 
    Color: [Gold] 
  Supports:
    Inside: [FullAbsorb]
    Outside: [Water]
    Surface: [StainlessSteel] 
    Color: [Grey] 
    # Rotation: [Z,24]              # defines repeated addition of the same mesh with [axis of rotation, number of copies]
